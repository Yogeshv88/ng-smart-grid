!function(){"use-strict";function SmartGridDirective(){return{restrict:"E",scope:{config:"="},templateUrl:"dist/templates/components/ngSmartGrid.html",controller:"SmartGridController",controllerAs:"sgc"}}function SmartGridController($scope,$timeout,$sce,$log){function adjustFreeWidth(){$("#"+gridId+" .free-table").css("max-width",$(window).width()-$("#"+gridId+" .locked-table").width()-30+"px")}function toggleLock(p){p.locked=!p.locked,updateData(vm.data)}function updatePreferences(preferences){preferences&&(vm.sortedPreferences=preferences.sort(function(a,b){return a.order-b.order}),vm.sortedPreferences.forEach(function(p){p.titleDisplayFn?p.displayTitle=$sce.trustAsHtml(p.titleDisplayFn(p.title)):p.displayTitle=$sce.trustAsHtml(p.title.toString()),p.hidden=!!p.hidden&&p.hidden}))}function updateData(data){var row;vm.sortedRows=[],data.data.forEach(function(d){var sorted=[];vm.sortedPreferences.forEach(function(p){if(p.hidden===!1){var value="";if(p.displayFn){var displayValue=p.displayFn(d[p.id],p,d);void 0===displayValue&&$log.error("Display function failed at: "+p.id),sorted.push({value:$sce.trustAsHtml(displayValue.toString()),locked:p.locked,key:d.id})}else null!==d[p.id]&&(void 0===d[p.id]&&$log.error("Cannot find this field inside data received: "+p.id),value=$sce.trustAsHtml((void 0===d[p.id]?"":d[p.id]).toString()),"object"==typeof d[p.id]&&(void 0!==d[p.id].defaultLabel&&(value=$sce.trustAsHtml(d[p.id].defaultLabel.toString())),void 0!==d[p.id].name&&(value=$sce.trustAsHtml(d[p.id].name.toString())))),sorted.push({value:value,locked:p.locked,key:d.id,column:p.id})}}),row={id:d.id,checked:vm.isAllChecked,values:sorted},vm.sortedRows.push(row)}),$timeout(function(){adjustFreeWidth()})}var vm=this;vm.scope=$scope,vm.config=$scope.config,vm.onLockClick=toggleLock,vm.isAllChecked=!0;var gridId=vm.config.gridId+"-grid";$(window).on("resize",function(){adjustFreeWidth()}),$scope.$watchCollection(function(){return vm.config.preferences},function(preferences){preferences&&(vm.preferences=preferences),vm.data&&updatePreferences(preferences)}),$scope.$watchCollection(function(){return vm.config.data},function(data){data&&data.data?(vm.data=data,updatePreferences(vm.preferences),updateData(data)):vm.sortedRows=[]})}angular.module("ng-smart-grid",[]).controller("SmartGridController",SmartGridController).directive("smartGrid",SmartGridDirective)}();